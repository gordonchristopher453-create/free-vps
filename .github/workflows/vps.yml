name: Free VPS
on:
  workflow_dispatch:
  schedule:
    - cron: '*/30 * * * *'
jobs:
  vps:
    runs-on: self-hosted
    steps:
      - name: Start Ngrok
        env:
          NGROK_AUTHTOKEN: ${{ secrets.NGROK_AUTHTOKEN }}
        run: |
          wget -q https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
          tar xvzf ngrok-v3-stable-linux-amd64.tgz
          sudo mv ngrok /usr/local/bin/
          ngrok config add-authtoken $NGROK_AUTHTOKEN
          pkill ngrok || true
          ngrok tcp 22 --log=stdout > ngrok.log &
          sleep 10
          echo "SSH: $(curl -s http://localhost:4040/api/tunnels | grep -o 'tcp://[^"]*')"
          while true; do sleep 60; echo "VPS ALIVE $(date)"; done
